# Billing Service Prototype

–ü–µ—Ç-–ø—Ä–æ–µ–∫—Ç, —ç–º—É–ª–∏—Ä—É—é—â–∏–π —Ä–∞–±–æ—Ç—É –±–∏–ª–ª–∏–Ω–≥–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã —Ç–µ–ª–µ–∫–æ–º-–æ–ø–µ—Ä–∞—Ç–æ—Ä–∞.
–û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å: —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ö–∞–Ω–∏–∑–º–∞ —Ç–∞—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∞–±–æ–Ω–µ–Ω—Ç–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ —Ä—É—á–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏.

## üõ† –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

* **Java 21**
* **Spring Boot 3.x** (Web, Data JPA, Validation)
* **PostgreSQL 15**
* **Docker & Docker Compose**
* **Maven** (Layered Jar build)

## –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

–í –ø—Ä–æ–µ–∫—Ç–µ –µ—Å—Ç—å —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–±–æ—Ä–∫–∏ –∏ –¥–µ–ø–ª–æ—è.
–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è: –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π Docker –∏ Docker Compose.

1.  –î–∞—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞–º:
    ```bash
    chmod +x deploy.sh mvnw
    ```
2.  –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–ø–ª–æ–π:
    ```bash
    ./deploy.sh
    ```
    *–°–∫—Ä–∏–ø—Ç —Å–æ–±–µ—Ä–µ—Ç .jar —á–µ—Ä–µ–∑ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (multistage build), —Å–æ–∑–¥–∞—Å—Ç –æ–±—Ä–∞–∑—ã –∏ –ø–æ–¥–Ω–∏–º–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –≤–º–µ—Å—Ç–µ —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º.*

3.  –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: `http://localhost:8080`

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### 1. –ü—Ä–æ—Ü–µ—Å—Å –ë–∏–ª–ª–∏–Ω–≥–∞ (`BillingCycleService`)
–°–∞–º–∞—è –Ω–∞–≥—Ä—É–∂–µ–Ω–Ω–∞—è —á–∞—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å —É—á–µ—Ç–æ–º –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∞–±–æ–Ω–µ–Ω—Ç–æ–≤:
* **–ü–∞–≥–∏–Ω–∞—Ü–∏—è:** –ê–±–æ–Ω–µ–Ω—Ç—ã –≤—ã—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∏–∑ –ë–î —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ (batch processing), —á—Ç–æ–±—ã –Ω–µ –∑–∞–±–∏—Ç—å Heap Memory.
* **–ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–∞—Å–ø–∞—Ä–∞–ª–ª–µ–ª–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `ThreadPoolTaskExecutor` (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ `BillingApplication.java`).
* **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:** –¢–∞–∫ –∫–∞–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–¥–µ—Ç –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–æ—Ç–æ–∫–∞—Ö, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `TransactionTemplate` –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ –≤–Ω—É—Ç—Ä–∏ –∫–∞–∂–¥–æ–≥–æ —Ç–∞—Å–∫–∞. –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å —Å–ø–∏—Å–∞–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤.

### 2. –û—Ç—á–µ—Ç–Ω–æ—Å—Ç—å (`ReportRepository`)
–î–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º (–∞–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö, –ø–æ–¥—Å—á–µ—Ç —Å—É–º–º) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **Native SQL** —á–µ—Ä–µ–∑ `JdbcTemplate`.
*–ü—Ä–∏—á–∏–Ω–∞:* JPA/Hibernate —Å–æ–∑–¥–∞–µ—Ç –æ–≤–µ—Ä—Ö–µ–¥ –ø—Ä–∏ —Å–ª–æ–∂–Ω—ã—Ö –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞—Ö, –∞ –Ω–∞—Ç–∏–≤–Ω—ã–π SQL –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∞–≥—Ä–µ–≥–∞—Ü–∏—é –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –±—ã—Å—Ç—Ä–æ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ë–î.

### 3. Docker Optimization
–í `Dockerfile` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `Layertools`. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –Ω–∞ —Ä–∞–∑–Ω—ã–µ —Å–ª–æ–∏. –≠—Ç–æ —É—Å–∫–æ—Ä—è–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—É—é —Å–±–æ—Ä–∫—É –æ–±—Ä–∞–∑–∞, —Ç–∞–∫ –∫–∞–∫ —Å–ª–æ–π —Å –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è Docker-–æ–º.

## –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

**Admin:**
* `POST /api/admin/run-billing-cycle` ‚Äî –ó–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞ –±–∏–ª–ª–∏–Ω–≥–∞ (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ).

**–¢–∞—Ä–∏—Ñ—ã –∏ –ê–±–æ–Ω–µ–Ω—Ç—ã:**
* `POST /api/tariffs` ‚Äî –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞.
* `POST /api/subscribers` ‚Äî –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∞–±–æ–Ω–µ–Ω—Ç–∞.

**–ê–Ω–∞–ª–∏—Ç–∏–∫–∞:**
* `GET /api/reports/tariffs` ‚Äî –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º (–¥–æ—Ö–æ–¥, –∫–æ–ª-–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∞–±–æ–Ω–µ–Ω—Ç–æ–≤).

## –ü–ª–∞–Ω—ã –ø–æ –¥–æ—Ä–∞–±–æ—Ç–∫–µ (To-Do)
* [ ] –î–æ–±–∞–≤–∏—Ç—å Swagger (OpenAPI) –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.
* [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º Retry –¥–ª—è —É–ø–∞–≤—à–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.
* [ ] –í—ã–Ω–µ—Å—Ç–∏ –±–∏–ª–ª–∏–Ω–≥-—Ü–∏–∫–ª –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å (Scheduled Job).
* [ ] –ü–æ–∫—Ä—ã—Ç—å —Ç–µ—Å—Ç–∞–º–∏ `BillingCycleService` (Testcontainers).
