# Ğ­Ğ¼ÑƒĞ»ÑÑ†Ğ¸Ñ Ğ±Ğ¸Ğ»Ğ»Ğ¸Ğ½Ğ³Ğ¾Ğ²Ğ¾Ğ¹ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹

Pet-Ğ¿Ñ€Ğ¾ĞµĞºÑ‚ â€” Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒĞ½Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ´Ğ»Ñ ÑĞ¼ÑƒĞ»ÑÑ†Ğ¸Ğ¸ Ğ±Ğ¸Ğ»Ğ»Ğ¸Ğ½Ğ³Ğ¾Ğ²Ñ‹Ñ… Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ¾Ğ² Ñ REST API.
ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ñ†ĞµĞ»ÑŒ: Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¼ĞµÑ…Ğ°Ğ½Ğ¸Ğ·Ğ¼Ğ° Ñ‚Ğ°Ñ€Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸ Ğ°Ğ±Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ² Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ Ğ¼Ğ½Ğ¾Ğ³Ğ¾Ğ¿Ğ¾Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¸ Ñ€ÑƒÑ‡Ğ½Ğ¾Ğ³Ğ¾ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸ÑĞ¼Ğ¸.

## ğŸ§° Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸
- **Backend:** Java 21, Spring Boot (Web, Data JPA, Validation)
- **Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…:** PostgreSQL
- **Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ:** Swagger/OpenAPI
- **ĞšĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ:** Docker, Docker Compose
- **Ğ¡Ğ±Ğ¾Ñ€ĞºĞ°:** Maven (Layered Jar build)

## ğŸ“ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

```mermaid
Soon...
```

### ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ñ‹Ğµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ

**1. ĞŸÑ€Ğ¾Ñ†ĞµÑÑ Ğ‘Ğ¸Ğ»Ğ»Ğ¸Ğ½Ğ³Ğ° (`BillingCycleService`)**
Ğ¡Ğ°Ğ¼Ğ°Ñ Ğ½Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ½Ğ°Ñ Ñ‡Ğ°ÑÑ‚ÑŒ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹, Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ Ñ ÑƒÑ‡ĞµÑ‚Ğ¾Ğ¼ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞµĞ¼Ğ¾ÑÑ‚Ğ¸:
- **ĞŸĞ°Ğ³Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ:** ĞĞ±Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ÑÑ‚ÑÑ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ°Ğ¼Ğ¸ (batch processing) Ğ´Ğ»Ñ ÑĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ğ¸ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸.
- **ĞœĞ½Ğ¾Ğ³Ğ¾Ğ¿Ğ¾Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ:** ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ† Ñ€Ğ°ÑĞ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ Ñ‡ĞµÑ€ĞµĞ· `ThreadPoolTaskExecutor`.
- **Ğ¢Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ğ¸:** Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ `TransactionTemplate` Ğ´Ğ»Ñ Ñ€ÑƒÑ‡Ğ½Ğ¾Ğ³Ğ¾ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸ÑĞ¼Ğ¸ Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ² Ğ³Ğ°Ñ€Ğ°Ğ½Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ğ°Ñ‚Ğ¾Ğ¼Ğ°Ñ€Ğ½Ğ¾ÑÑ‚ÑŒ ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ ÑÑ€ĞµĞ´ÑÑ‚Ğ².

**2. ĞÑ‚Ñ‡ĞµÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ (`ReportRepository`)**
Ğ”Ğ»Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸ (Ğ°Ğ³Ñ€ĞµĞ³Ğ°Ñ†Ğ¸Ñ, ÑÑƒĞ¼Ğ¼Ñ‹) Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ **Native SQL** Ñ‡ĞµÑ€ĞµĞ· `JdbcTemplate` Ğ´Ğ»Ñ Ğ¼Ğ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸, Ğ¸ÑĞºĞ»ÑÑ‡Ğ°Ñ Ğ¾Ğ²ĞµÑ€Ñ…ĞµĞ´ JPA.

**3. Docker Optimization**
Ğ’ `Dockerfile` Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ `Layertools` Ğ´Ğ»Ñ ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ÑĞ»Ğ¾ĞµĞ² Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹, Ñ‡Ñ‚Ğ¾ ÑƒÑĞºĞ¾Ñ€ÑĞµÑ‚ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½ÑƒÑ ÑĞ±Ğ¾Ñ€ĞºÑƒ.

## ğŸš€ Ğ—Ğ°Ğ¿ÑƒÑĞº

```bash
# 1. ĞšĞ»Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹
git clone https://github.com/nv/billing.git
cd billing

# 2. Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ñ‡ĞµÑ€ĞµĞ· Docker (Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ ÑĞ±Ğ¾Ñ€ĞºĞ°)
docker-compose up -d

# 3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñƒ (Swagger UI)
# ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ Ğ² Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğµ: http://localhost:8080/swagger-ui/index.html
```

> **ĞĞ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ½Ğ¾:** ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞºÑ€Ğ¸Ğ¿Ñ‚ `./deploy.sh` Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ³Ğ¾ Ñ†Ğ¸ĞºĞ»Ğ° Ğ¿ĞµÑ€ĞµÑĞ±Ğ¾Ñ€ĞºĞ¸ Ğ¸ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°.

## ğŸ“– API

ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ endpoints:
- `POST /api/subscribers` â€” Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ°Ğ±Ğ¾Ğ½ĞµĞ½Ñ‚Ğ°
- `POST /api/tariffs` â€” Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ‚Ğ°Ñ€Ğ¸Ñ„Ğ°
- `POST /api/admin/run-billing-cycle` â€” Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ° Ğ±Ğ¸Ğ»Ğ»Ğ¸Ğ½Ğ³Ğ° (Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ¾)
- `GET /api/reports/tariffs` â€” Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ¿Ğ¾ Ñ‚Ğ°Ñ€Ğ¸Ñ„Ğ°Ğ¼ (Ğ´Ğ¾Ñ…Ğ¾Ğ´, ĞºĞ¾Ğ»-Ğ²Ğ¾ Ğ°Ğ±Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²)

ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ° Ğ¿Ğ¾ÑĞ»Ğµ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°:
- Swagger UI: `http://localhost:8080/swagger-ui/index.html`
- OpenAPI ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ: `http://localhost:8080/v3/api-docs`

## ğŸ’¡ ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ñ

1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ° (Ğ°Ğ±Ğ¾Ğ½ĞµĞ½Ñ‚Ğ°) Ñ‡ĞµÑ€ĞµĞ· API
2. ĞĞ°Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚ÑŒ Ñ‚Ğ°Ñ€Ğ¸Ñ„Ğ½Ñ‹Ğ¹ Ğ¿Ğ»Ğ°Ğ½
3. Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¾Ğ± Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¸ (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)
4. Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ñ€Ğ°ÑÑ‡ĞµÑ‚Ğ½Ñ‹Ğ¹ Ñ†Ğ¸ĞºĞ» (`run-billing-cycle`)
5. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ¾Ñ‚Ñ‡ĞµÑ‚

## ğŸ§ª Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

```bash
# Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ñ‚ĞµÑÑ‚Ñ‹
./mvnw test
```

## ğŸ“ Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

```
Directory structure:
â””â”€â”€ thunderbolted-soup-billing/
    â”œâ”€â”€ README.md
    â”œâ”€â”€ deploy.sh
    â”œâ”€â”€ docker-compose.yml
    â”œâ”€â”€ Dockerfile
    â”œâ”€â”€ mvnw
    â”œâ”€â”€ mvnw.cmd
    â”œâ”€â”€ pom.xml
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ main/
    â”‚   â”‚   â”œâ”€â”€ java/
    â”‚   â”‚   â”‚   â””â”€â”€ kg/
    â”‚   â”‚   â”‚       â””â”€â”€ dementia/
    â”‚   â”‚   â”‚           â””â”€â”€ billing/
    â”‚   â”‚   â”‚               â”œâ”€â”€ BillingApplication.java
    â”‚   â”‚   â”‚               â”œâ”€â”€ config/
    â”‚   â”‚   â”‚               â”‚   â””â”€â”€ OpenApiConfig.java
    â”‚   â”‚   â”‚               â”œâ”€â”€ controllers/
    â”‚   â”‚   â”‚               â”‚   â”œâ”€â”€ BillingController.java
    â”‚   â”‚   â”‚               â”‚   â”œâ”€â”€ BillingCycleController.java
    â”‚   â”‚   â”‚               â”‚   â””â”€â”€ ReportController.java
    â”‚   â”‚   â”‚               â”œâ”€â”€ dto/
    â”‚   â”‚   â”‚               â”‚   â”œâ”€â”€ SubscriberDto.java
    â”‚   â”‚   â”‚               â”‚   â”œâ”€â”€ TariffAnalyticsDto.java
    â”‚   â”‚   â”‚               â”‚   â””â”€â”€ TariffDto.java
    â”‚   â”‚   â”‚               â”œâ”€â”€ exception/
    â”‚   â”‚   â”‚               â”‚   â”œâ”€â”€ GlobalExceptionHandler.java
    â”‚   â”‚   â”‚               â”‚   â”œâ”€â”€ ResourceConflictException.java
    â”‚   â”‚   â”‚               â”‚   â””â”€â”€ ResourceNotFoundException.java
    â”‚   â”‚   â”‚               â”œâ”€â”€ mappers/
    â”‚   â”‚   â”‚               â”‚   â”œâ”€â”€ SubscriberMapper.java
    â”‚   â”‚   â”‚               â”‚   â””â”€â”€ TariffMapper.java
    â”‚   â”‚   â”‚               â”œâ”€â”€ models/
    â”‚   â”‚   â”‚               â”‚   â”œâ”€â”€ Subscriber.java
    â”‚   â”‚   â”‚               â”‚   â””â”€â”€ Tariff.java
    â”‚   â”‚   â”‚               â”œâ”€â”€ repository/
    â”‚   â”‚   â”‚               â”‚   â”œâ”€â”€ ReportRepository.java
    â”‚   â”‚   â”‚               â”‚   â”œâ”€â”€ SubscriberRepository.java
    â”‚   â”‚   â”‚               â”‚   â””â”€â”€ TariffRepository.java
    â”‚   â”‚   â”‚               â””â”€â”€ services/
    â”‚   â”‚   â”‚                   â”œâ”€â”€ BillingCycleService.java
    â”‚   â”‚   â”‚                   â”œâ”€â”€ SubscriberService.java
    â”‚   â”‚   â”‚                   â””â”€â”€ TariffService.java
    â”‚   â”‚   â””â”€â”€ resources/
    â”‚   â”‚       â””â”€â”€ application.properties
    â”‚   â””â”€â”€ test/
    â”‚       â”œâ”€â”€ java/
    â”‚       â”‚   â””â”€â”€ kg/
    â”‚       â”‚       â””â”€â”€ dementia/
    â”‚       â”‚           â””â”€â”€ billing/
    â”‚       â”‚               â”œâ”€â”€ AbstractIntegrationTest.java
    â”‚       â”‚               â”œâ”€â”€ BillingApplicationTests.java
    â”‚       â”‚               â””â”€â”€ services/
    â”‚       â”‚                   â”œâ”€â”€ BillingCycleServiceIT.java
    â”‚       â”‚                   â”œâ”€â”€ BillingCycleServiceTest.java
    â”‚       â”‚                   â”œâ”€â”€ SubscriberServiceTest.java
    â”‚       â”‚                   â””â”€â”€ TariffServiceTest.java
    â”‚       â””â”€â”€ resources/
    â”‚           â””â”€â”€ application.properties
    â””â”€â”€ .mvn/
        â””â”€â”€ wrapper/
            â””â”€â”€ maven-wrapper.properties

```

## ĞŸĞ»Ğ°Ğ½Ñ‹ Ğ¿Ğ¾ Ğ´Ğ¾Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞµ (To-Do)
* [x] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Swagger (OpenAPI) Ğ´Ğ»Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ğ¸.
* [x] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¼ĞµÑ…Ğ°Ğ½Ğ¸Ğ·Ğ¼ Retry Ğ´Ğ»Ñ ÑƒĞ¿Ğ°Ğ²ÑˆĞ¸Ñ… Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ğ¹.
* [ ] Ğ’Ñ‹Ğ½ĞµÑÑ‚Ğ¸ Ğ±Ğ¸Ğ»Ğ»Ğ¸Ğ½Ğ³-Ñ†Ğ¸ĞºĞ» Ğ² Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¼Ğ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸Ñ (Scheduled Job).
* [x] ĞŸĞ¾ĞºÑ€Ñ‹Ñ‚ÑŒ Ñ‚ĞµÑÑ‚Ğ°Ğ¼Ğ¸ `BillingCycleService` (Testcontainers).
